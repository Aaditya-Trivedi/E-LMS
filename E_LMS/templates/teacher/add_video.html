{% extends 'base2.html' %}
{% block title %}Add Videos{% endblock %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
      {% include 'teacher/teacher_sidebar.html' %}
     <div class="col-md-10 ms-auto p-4 bg-light" style="min-height: 100vh;">

  <!-- Course selection form -->
  <form method="GET" action="{% url 'add_video' %}" class="mb-4">
    <div class="mb-3">
      <label>Select Course:</label>
      <select name="course" class="form-select" id="course-select" onchange="this.form.submit()">
        <option value="">-- Select Course --</option>
        {% for course in courses %}
          <option value="{{ course.id }}" {% if course.id == selected_course_id %} selected{% endif %} >
            {{ course.title }}
          </option>
        {% endfor %}
      </select>
    </div>
  </form>

  <!-- Video submission form -->
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Lesson Dropdown -->
    <div class="mb-3">
      <label>Select Lesson:</label>
      {% if lessons %}
        <select name="lesson" class="form-select" id="lesson-select" required>
          {% for lesson in lessons %}
            <option value="{{ lesson.id }}">{{ lesson.name }} ({{ lesson.course.title }})</option>
          {% endfor %}
        </select>
      {% else %}
        <div class="alert alert-warning">
          {% if selected_course_id %}
            No lessons found for the selected course.
          {% else %}
            Please select a course first to see lessons.
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- Serial Number -->
    <div class="mb-3">
      <label>Serial Number:</label>
      <input type="number" name="serial_number" class="form-control" id="serialNumberInput" readonly>
    </div>

    <!-- Title -->
    <div class="mb-3">
      <label>Title:</label>
      <input type="text" name="title" class="form-control">
    </div>

    <!-- Video File Upload -->
    <div class="mb-3">
      <label>Upload Video File:</label>
      <input type="file" name="video_file" class="form-control" accept="video/*">
    </div>

    <!-- Duration -->
    <div class="mb-3">
      <label>Duration (in minutes  ):</label>
      <input type="number" name="time_duration" class="form-control">
    </div>

    <!-- Thumbnail -->
    <div class="mb-3">
      <label>Thumbnail Image:</label>
      <input type="file" name="thumbnail" class="form-control">
    </div>


    <!-- Submit Button -->
    <button type="submit" class="btn btn-success">Add Video</button>
  </form>
</div>
  </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    $('#lesson-select').on('change', function () {
      const lessonId = $(this).val();

      if (lessonId) {
        $.ajax({
          url: '{% url "get_next_serial_number" %}',
          data: {
            'lesson_id': lessonId
          },
          success: function (data) {
            $('#serialNumberInput').val(data.next_serial);
          },
          error: function () {
            alert('Error loading serial number.');
          }
        });
      }
    });

    // Trigger on load if lesson already selected
    $('#lesson-select').trigger('change');
  });
</script>

{% endblock %}
